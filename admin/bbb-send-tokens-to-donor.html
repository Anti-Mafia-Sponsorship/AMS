<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Owner Panel - –ò–∑–ø—Ä–∞—Ç–∏ –¢–æ–∫–µ–Ω–∏</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #0a0e27; color: #fff; }
        nav { background: #1a1f3a; padding: 20px; text-align: center; }
        nav a { color: #667eea; text-decoration: none; margin: 0 15px; font-size: 1.1em; }
        nav a:hover { color: #fff; }
        .container { max-width: 900px; margin: 60px auto; padding: 40px; }
        h1 { font-size: 2.5em; color: #4caf50; text-align: center; margin-bottom: 20px; }
        .subtitle { text-align: center; color: #b8c5d6; font-size: 1.2em; margin-bottom: 50px; }
        .panel-box { background: #1a1f3a; padding: 40px; border-radius: 20px; margin: 30px 0; border: 3px solid #4caf50; }
        .panel-box h2 { color: #667eea; font-size: 2em; margin-bottom: 20px; }
        .panel-box p { color: #b8c5d6; line-height: 1.8; margin-bottom: 15px; }
        .form-group { margin: 25px 0; }
        .form-group label { display: block; color: #667eea; font-size: 1.2em; margin-bottom: 10px; font-weight: bold; }
        .form-group input { width: 100%; padding: 15px; border-radius: 10px; border: 2px solid #667eea; background: #0a0e27; color: #fff; font-size: 1.1em; }
        .btn { background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%); color: white; padding: 20px 50px; border-radius: 50px; font-size: 1.3em; font-weight: bold; border: none; cursor: pointer; transition: transform 0.3s; width: 100%; margin-top: 20px; }
        .btn:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(76, 175, 80, 0.4); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .info-box { background: #4caf50; color: #fff; padding: 30px; border-radius: 15px; margin: 30px 0; }
        .warning-box { background: #ff5722; color: #fff; padding: 30px; border-radius: 15px; margin: 30px 0; }
        .timeout-box { background: #ffc107; color: #000; padding: 30px; border-radius: 15px; margin: 30px 0; font-weight: bold; }
        .status { padding: 20px; border-radius: 10px; margin-top: 20px; display: none; }
        .queue-box { background: #0a0e27; padding: 25px; border-radius: 10px; border-left: 4px solid #4caf50; margin: 20px 0; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
</head>
<body>
    <nav>
        <a href="index.html">–ù–∞—á–∞–ª–æ</a>
        <a href="aaa-add-liquidity.html">–ê–ê–ê: –õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç</a>
        <a href="bbb-send-tokens-to-donor.html">–ë–ë–ë: –ò–∑–ø—Ä–∞—Ç–∏ –¢–æ–∫–µ–Ω–∏</a>
        <a href="ggg-mint-and-send.html">–ì–ì–ì: Mint –∏ –ò–∑–ø—Ä–∞—Ç–∏</a>
        <a href="vvv-mint-new-AMS.html">–í–í–í: Mint –ù–æ–≤–∏</a>
        <a href="contact.html">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a>
    </nav>

    <div class="container">
        <h1>üí∏ –ë–ë–ë: –ò–∑–ø—Ä–∞—Ç–∏ –¢–æ–∫–µ–Ω–∏ –Ω–∞ –î–∞—Ä–∏—Ç–µ–ª</h1>
        <p class="subtitle">–ò–∑–ø—Ä–∞—Ç–∏ –°–™–©–ï–°–¢–í–£–í–ê–©–ò —Ç–æ–∫–µ–Ω–∏ –æ—Ç —Ç–≤–æ—è —Ä–µ–∑–µ—Ä–≤ ‚Üí –¶–µ–Ω–∞—Ç–∞ –ù–ï —Å–µ –ø—Ä–æ–º–µ–Ω—è</p>
        
        <div class="info-box">
            <h3>üìã –ö–∞–∫–≤–æ –ø—Ä–∞–≤–∏ —Ç–∞–∑–∏ —Ñ—É–Ω–∫—Ü–∏—è?</h3>
            <p style="font-size: 1.2em; line-height: 1.8;">
                <strong>–ò–∑–ø—Ä–∞—â–∞—à —Ç–æ–∫–µ–Ω–∏ –æ—Ç –¢–í–û–Ø —Ä–µ–∑–µ—Ä–≤ –∫—ä–º –¥–∞—Ä–∏—Ç–µ–ª</strong><br><br>
                
                ‚úÖ –¢–æ–∫–µ–Ω–∏—Ç–µ –°–ê –í–ï–ß–ï —Å—ä–∑–¥–∞–¥–µ–Ω–∏ (–æ—Ç –Ω–∞—á–∞–ª–Ω–∏—Ç–µ 40M)<br>
                ‚úÖ Supply –ù–ï —Å–µ –ø—Ä–æ–º–µ–Ω—è<br>
                ‚úÖ –¶–µ–Ω–∞—Ç–∞ –ù–ï —Å–µ –ø—Ä–æ–º–µ–Ω—è<br>
                ‚úÖ –ü—Ä–æ—Å—Ç–æ –ø—Ä–µ–º–µ—Å—Ç–≤–∞—à —Ç–æ–∫–µ–Ω–∏ –æ—Ç —Ç–≤–æ–π –∫—ä–º –¥—Ä—É–≥ wallet<br><br>
                
                <strong>–ò–∑–ø–æ–ª–∑–≤–∞–π –∑–∞:</strong> –†—ä—á–Ω–æ –∏–∑–ø—Ä–∞—â–∞–Ω–µ –Ω–∞ –Ω–∞–≥—Ä–∞–¥–∏ –Ω–∞ –¥–∞—Ä–∏—Ç–µ–ª–∏ (–í–∞—Ä–∏–∞–Ω—Ç –ê)
            </p>
        </div>
        
        <div class="timeout-box">
            <h3>‚è≥ –î–ò–ù–ê–ú–ò–ß–ï–ù –¢–ê–ô–ú–ê–£–¢</h3>
            <p style="font-size: 1.2em; line-height: 1.8;">
                üïê <strong>–ë–∞–∑–æ–≤:</strong> 12 —á–∞—Å–∞ –º–µ–∂–¥—É –∏–∑–ø—Ä–∞—â–∞–Ω–∏—è<br>
                ‚ö° <strong>–£—Å–∫–æ—Ä–µ–Ω:</strong> 30 –º–∏–Ω—É—Ç–∏ (–ø—Ä–∏ –ø–æ–≤–µ—á–µ –æ—Ç 1000 –≤ –æ–ø–∞—à–∫–∞—Ç–∞)<br><br>
                
                üéØ <strong>–¢–µ–∫—É—â timeout:</strong> <span id="currentTimeout">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</span><br>
                üéØ <strong>–î–∞—Ä–∏—Ç–µ–ª–∏ –≤ –æ–ø–∞—à–∫–∞:</strong> <span id="queueCount">0</span>
            </p>
        </div>
        
        <div class="panel-box">
            <h2>üîß –ò–∑–ø—Ä–∞—Ç–∏ –¢–æ–∫–µ–Ω–∏</h2>
            
            <div class="form-group">
                <label>–ê–¥—Ä–µ—Å –Ω–∞ –¥–∞—Ä–∏—Ç–µ–ª:</label>
                <input type="text" id="recipientAddress" placeholder="0x...">
            </div>
            
            <div class="form-group">
                <label>–ö–æ–ª–∫–æ AMS —Ç–æ–∫–µ–Ω–∏? (Max 1000)</label>
                <input type="number" id="tokenAmount" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1000" step="1" max="1000" min="1">
            </div>
            
            <div class="queue-box">
                <strong style="color: #4caf50;">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</strong><br><br>
                <span style="color: #b8c5d6;">
                –ü–æ—Å–ª–µ–¥–Ω–æ –∏–∑–ø—Ä–∞—â–∞–Ω–µ: <span id="lastSent">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</span><br>
                –í—Ä–µ–º–µ –¥–æ —Å–ª–µ–¥–≤–∞—â–æ: <span id="timeRemaining">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</span><br>
                –¢–≤–æ–π –±–∞–ª–∞–Ω—Å: <span id="ownerBalance">0 AMS</span><br>
                –î–∞—Ä–∏—Ç–µ–ª–∏ –≤ –æ–ø–∞—à–∫–∞: <span id="queueLength">0</span>
                </span>
            </div>
            
            <button class="btn" id="sendBtn" onclick="sendTokens()">üí∏ –ò–∑–ø—Ä–∞—Ç–∏ –¢–æ–∫–µ–Ω–∏</button>
            
            <div id="status" class="status"></div>
        </div>
        
        <div class="warning-box">
            <h3>‚ö†Ô∏è –í–ê–ñ–ù–û: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è</h3>
            <p style="font-size: 1.1em; line-height: 1.8;">
                üîí <strong>–ú–∞–∫—Å–∏–º—É–º 1000 AMS –Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è</strong><br>
                üîí <strong>Timeout: 12 —á–∞—Å–∞ –º–µ–∂–¥—É –∏–∑–ø—Ä–∞—â–∞–Ω–∏—è</strong> (–Ω–∞–º–∞–ª—è–≤–∞ –¥–æ 30 –º–∏–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ)<br>
                üîí –°–∞–º–æ Owner –º–æ–∂–µ –¥–∞ –∏–∑–≤–∏–∫–∞ —Ç–∞–∑–∏ —Ñ—É–Ω–∫—Ü–∏—è<br>
                üîí –ù–µ –º–æ–∂–µ—à –¥–∞ –∏–∑–ø—Ä–∞—Ç–∏—à –ø–æ–≤–µ—á–µ –æ—Ç —Ç–≤–æ—è –±–∞–ª–∞–Ω—Å<br>
                üîí –ê–¥—Ä–µ—Å—ä—Ç —Ç—Ä—è–±–≤–∞ –¥–∞ –µ –≤–∞–ª–∏–¥–µ–Ω BEP-20 address
            </p>
        </div>
    </div>

    <script>
        const CONTRACT_ADDRESS = 'YOUR_CONTRACT_ADDRESS_HERE'; // –ó–ê–ú–ï–ù–ò –° –†–ï–ê–õ–ù–ò–Ø –ê–î–†–ï–°!
        
        const CONTRACT_ABI = [
            {
                "inputs": [{"internalType": "address", "name": "donor", "type": "address"}, {"internalType": "uint256", "name": "amount", "type": "uint256"}],
                "name": "CPanelSendTokensToDonor",
                "outputs": [{"internalType": "bool", "name": "", "type": "bool"}],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "balanceOf",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getQueueLength",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "lastOwnerTransferTime",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "ownerTransferTimeout",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            }
        ];
        
        let web3;
        let contract;
        let userAccount;
        
        async function init() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    web3 = new Web3(window.ethereum);
                    const accounts = await web3.eth.getAccounts();
                    userAccount = accounts[0];
                    
                    contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                    
                    await updateStats();
                    
                    // –û–±–Ω–æ–≤—è–≤–∞–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏—Ç–µ –Ω–∞ –≤—Å–µ–∫–∏ –º–∏–Ω—É—Ç–∞
                    setInterval(updateStats, 60000);
                    
                } catch (error) {
                    showStatus('‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ —Å–≤—ä—Ä–∑–≤–∞–Ω–µ —Å MetaMask: ' + error.message, 'error');
                }
            } else {
                showStatus('‚ùå –ú–æ–ª—è, –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–π MetaMask!', 'error');
            }
        }
        
        async function updateStats() {
            try {
                // –í–∑–µ–º–∏ –±–∞–ª–∞–Ω—Å –Ω–∞ owner
                const balance = await contract.methods.balanceOf(userAccount).call();
                const balanceFormatted = web3.utils.fromWei(balance, 'ether');
                document.getElementById('ownerBalance').textContent = parseFloat(balanceFormatted).toLocaleString('bg-BG') + ' AMS';
                
                // –í–∑–µ–º–∏ –¥—ä–ª–∂–∏–Ω–∞ –Ω–∞ –æ–ø–∞—à–∫–∞—Ç–∞
                const queueLength = await contract.methods.getQueueLength().call();
                document.getElementById('queueLength').textContent = queueLength;
                document.getElementById('queueCount').textContent = queueLength;
                
                // –í–∑–µ–º–∏ –ø–æ—Å–ª–µ–¥–Ω–æ –≤—Ä–µ–º–µ –Ω–∞ –∏–∑–ø—Ä–∞—â–∞–Ω–µ
                const lastTime = await contract.methods.lastOwnerTransferTime().call();
                const lastTimeMs = parseInt(lastTime) * 1000;
                
                if (lastTimeMs > 0) {
                    const date = new Date(lastTimeMs);
                    document.getElementById('lastSent').textContent = date.toLocaleString('bg-BG');
                } else {
                    document.getElementById('lastSent').textContent = '–ù–∏–∫–æ–≥–∞';
                }
                
                // –í–∑–µ–º–∏ timeout
                const timeout = await contract.methods.ownerTransferTimeout().call();
                const timeoutHours = parseInt(timeout) / 3600;
                
                if (timeoutHours === 12) {
                    document.getElementById('currentTimeout').textContent = '12 —á–∞—Å–∞';
                } else {
                    document.getElementById('currentTimeout').textContent = '30 –º–∏–Ω—É—Ç–∏';
                }
                
                // –ò–∑—á–∏—Å–ª–∏ –æ—Å—Ç–∞–≤–∞—â–æ –≤—Ä–µ–º–µ
                const now = Date.now();
                const nextAllowedTime = lastTimeMs + (parseInt(timeout) * 1000);
                const remaining = nextAllowedTime - now;
                
                if (remaining > 0) {
                    const minutes = Math.ceil(remaining / 1000 / 60);
                    document.getElementById('timeRemaining').textContent = minutes + ' –º–∏–Ω—É—Ç–∏';
                    document.getElementById('sendBtn').disabled = true;
                } else {
                    document.getElementById('timeRemaining').textContent = '–ì–æ—Ç–æ–≤!';
                    document.getElementById('sendBtn').disabled = false;
                }
                
            } catch (error) {
                console.error('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }
        
        async function sendTokens() {
            const recipient = document.getElementById('recipientAddress').value.trim();
            const amount = parseFloat(document.getElementById('tokenAmount').value);
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!recipient || !recipient.startsWith('0x') || recipient.length !== 42) {
                showStatus('‚ùå –ù–µ–≤–∞–ª–∏–¥–µ–Ω –∞–¥—Ä–µ—Å! –¢—Ä—è–±–≤–∞ –¥–∞ –∑–∞–ø–æ—á–≤–∞ —Å 0x –∏ –¥–∞ –µ 42 —Å–∏–º–≤–æ–ª–∞.', 'error');
                return;
            }
            
            if (!amount || amount < 1 || amount > 1000) {
                showStatus('‚ùå –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ—Ç–æ —Ç—Ä—è–±–≤–∞ –¥–∞ –µ –º–µ–∂–¥—É 1 –∏ 1000 AMS!', 'error');
                return;
            }
            
            try {
                showStatus('üîÑ –ò–∑–ø—Ä–∞—â–∞–Ω–µ –Ω–∞ —Ç–æ–∫–µ–Ω–∏...', 'info');
                document.getElementById('sendBtn').disabled = true;
                
                const amountWei = web3.utils.toWei(amount.toString(), 'ether');
                
                const tx = await contract.methods.CPanelSendTokensToDonor(recipient, amountWei).send({
                    from: userAccount,
                    gas: 200000
                });
                
                showStatus(`‚úÖ –£—Å–ø–µ—à–Ω–æ –∏–∑–ø—Ä–∞—Ç–µ–Ω–∏ ${amount} AMS –∫—ä–º ${recipient.substring(0, 6)}...${recipient.substring(38)}<br>–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è: ${tx.transactionHash}`, 'success');
                
                // –û–±–Ω–æ–≤–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏—Ç–µ —Å–ª–µ–¥ 3 —Å–µ–∫—É–Ω–¥–∏
                setTimeout(updateStats, 3000);
                
            } catch (error) {
                showStatus('‚ùå –ì—Ä–µ—à–∫–∞: ' + error.message, 'error');
                document.getElementById('sendBtn').disabled = false;
            }
        }
        
        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.innerHTML = message;
            status.style.display = 'block';
            
            if (type === 'success') {
                status.style.background = '#4caf50';
            } else if (type === 'error') {
                status.style.background = '#ff5722';
            } else {
                status.style.background = '#ffc107';
                status.style.color = '#000';
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–∞–π –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ
        window.addEventListener('load', init);
    </script>
</body>
</html>
